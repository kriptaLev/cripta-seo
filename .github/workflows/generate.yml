name: Generate SEO pages

on:
  workflow_dispatch:

jobs:
  generate:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Generate pages
        run: |
          mkdir -p pages
          while read keyword; do
            slug=$(echo "$keyword" | tr '[:upper:]' '[:lower:]' | sed 's/[^а-яa-z0-9 ]//g' | sed 's/ /-/g')
            file="pages/$slug.md"

            cp template.md "$file"
            sed -i "s/{{TITLE}}/$keyword/g" "$file"
            sed -i "s/{{KEYWORD}}/$keyword/g" "$file"
            sed -i "s/{{INTRO}}/Подробный и актуальный разбор запроса \"$keyword\" для русскоязычной аудитории./g" "$file"
            sed -i "s/{{SECTION1}}/В этом разделе объясняется суть запроса $keyword и почему он интересен пользователям./g" "$file"
            sed -i "s/{{SECTION2}}/Здесь простым языком описывается, как работает тема $keyword./g" "$file"
            sed -i "s/{{SECTION3}}/Пошаговое объяснение для новичков по теме $keyword без сложных терминов./g" "$file"
            sed -i "s/{{SECTION4}}/Рассматриваются плюсы и возможные ограничения, связанные с $keyword./g" "$file"
            sed -i "s/{{FAQ}}/Ответы на популярные вопросы, которые ищут по запросу $keyword./g" "$file"
            sed -i "s|{{TG_LINK}}|#|g" "$file"

          done < keywords.txt

      - name: Commit pages
        run: |
          git config user.name "seo-bot"
          git config user.email "seo@bot.com"
          git add pages
          git commit -m "Auto-generate SEO pages"
          git push
