name: Generate SEO pages

on:
  workflow_dispatch:

jobs:
  generate:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Create pages from content.txt
        run: |
          rm -rf pages
          mkdir pages

          awk '
          /^===FILE:/ {
            if (out) close(out)
            filename=$2
            gsub("===","",filename)
            out="pages/" filename
            next
          }
          {
            if (out) print > out
          }
          ' content.txt

      - name: Commit pages
        run: |
          git config user.name "seo-bot"
          git config user.email "seo-bot@users.noreply.github.com"
          git add pages
          git commit -m "Auto-generate SEO articles" || echo "Nothing to commit"
          git push
